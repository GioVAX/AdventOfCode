module Day03

let data = 
 [|
    "............#....#............."; "...........##....#......#..#..#"; "......#.......#......#........."; "..#.#....#....#.............##."; "..#........####....#...#......."; "..##.....#.#.#..#.........#...."; "...#.#..#..#....#..#..#........"; "#.......#.........#....##.###.."; "......##..#.#...#.......#.#...."; "................##.........#.##"; "..##..........#...#.........#.#"; "..........#...##..............."; "#...#......#..#.#..#...##..#..."; "..##....#.......#......#..#...."; "....#......#......#....#......."; ".........#.....#..#............"; ".#...#.#.........#........#...."; "#..........####.....#.........."; "......##.....#....#..#........#"; "#......#......#...........#...."; "....#.........#....#...#..#..#."; ".#........#......#.#.....#....."; "..#.#.#..........#....#.......#"; "......#.#........##....##....##"; ".....#.#..#...#................"; "......#......##...............#"; "..#..##.............#...##....."; "......##......##..#......#....."; "....#.............#..##.....##."; "........#...............##....."; "..#......#.##..#...#....#...#.."; "#......#.......#.............#."; ".....#....##..............#...."; "#.#.........#....#..##....#...."; ".#...#...#....#.#............#."; "...#...#.#..##.##.......##....."; "......#..#....##..#.#..#..#...."; ".......##..#..#......#..#.....#"; ".##..#......#..........#....#.."; ".....#................#..#....#"; "........#..#....#.......#....#."; "..#......#.......#......#....#."; "....#...#.##........##....#...."; ".....#........#...........#...."; "...#....##..........#..#...#.#."; "...#.......#......#...##...#..."; ".#.....#........#........#.#..#"; ".#.........#..##.....#.......#."; "....#..#....#.......#......#..."; ".#.#...##..##................##";
    "......#.#...#.......#....#....#"; "........#....#..#.....#......#."; ".......#..........#......#....."; "..............................."; "..#..#####..#..#..........#.#.."; ".....#....##................#.#"; ".................##............"; ".#...#...#..#...........#...##."; "..#..#.#...........#.....##...."; ".#.......#.....#..##..#.#....#."; "..........#.#......##...##....."; "........##..#......##...#......"; "#......................#......."; "............#.....#....#.#...#."; "#......#..........##..#........"; ".........#.......#...#.#......."; "...........##....#........#...."; "#........#.....#...#........##."; ".#......##......#.##.......#..#"; ".....#......#.#......#.......#."; ".....#.#.........#............."; "...........#..#....#.....#.#..."; "...#............#...#.........."; "..#..#...#....................."; "......#..#...#....#............"; ".#.#.#........#..#...#........."; "..........#........#..#........"; "..............#...#....#......."; "..#....#....##.......#...#.##.."; ".#.........#...#......#........"; "..#......#...#.........##.#...#"; "...#.....#...#..#.............#"; ".##........#.#.#.............#."; "..#.............#..#.#...#....#"; "#...#.........#......#......#.."; ".......##..#.#..........#...#.."; ".......#.............#..#.#...."; ".#..#....#.#..................."; "....##...#..#....#..#.........."; "....#.#............#..........."; "###........##..#.#..#.........."; ".#.#.#.......#...........#..#.#"; "..........##..#.............#.."; ".#...........#......#.#..#..##."; "...###......#.##........#.....#"; "....#..#..#...#................"; "...#.....#........#............"; "....#...#...#..#..##.##.......#"; "#.......#......#....#.......#.."; "#.............#...#............";
    "##......#..#...#....##.#...#..."; ".##....................#....#.."; "..#.....#....#.#....#......#..."; ".......#..#..#............#...#"; ".#.....#.......#..#..#..#......"; "......##......................."; "#..#...#.#.#....#.....#..#....."; "...................#...#...#..."; "........#....##..#....#........"; "##......#.#......##.###........"; ".........#...##................"; ".......#...#...#.......##......"; "....#.......#......#.........##"; "....#....#.#..#.....#.........."; "...........#.......#........#.."; "..#.........###.#........#....."; ".......#...........#.#.....##.."; "..#...#..#..........#.........."; "..........#.#....#............."; ".##....#........##............."; ".............#.#####........#.#"; ".................##...#........"; "##...#.#.......##........#....."; ".#...#...#..#..#....#....#....."; "..#...#........#..#............"; "##...#.#........#......##.#..##"; ".##......#..............##.#..#"; ".........#...#............#...#"; "....#..#....#...........#......"; "........#..#....#...##...#....."; "..#..............#...#.#.....#."; ".#.......#.#.....#..###.......#"; "...................#.......#..."; "........##.....#..#.......##..."; ".....#....................#...#"; "...#.#....#............#.#....."; "#.......#.......#....#........."; "..#...............#............"; "##...#...#...#..............#.."; "...#..........#..#....##......."; "#............##.##......#.#.#.."; ".#...........#.........#....##."; "..##....##.#....#.#.#.##...##.#"; "........#.#.#.............#...."; ".#...........#....##...#...#.#."; ".##...#.................#......"; "....#.#..#....................#"; ".##......#........#..#........."; "...#...............#..........."; ".#.#..##..##.#........#........";
    "...........#....#.#.#......#..."; "...................#........#.#"; "..#............#...#.#........#"; "....#....#.#.##......#...#....."; "..................#............"; "..........................#...."; "........#......................"; "......#.#...#.#..##......#.#.#."; ".........#...#..#.............."; "..#.......#..........##..#....."; ".........#............#........"; "......#..#..#...###....#....#.."; "#..#..............##.###..##..#"; ".#..................#.....#...#"; "........#........#........#...."; ".........#........#.##......#.."; "..#.....#.#..###...#....#......"; "..#................##....#....."; "..#.#....##.....#......##...#.."; "...#.......#........##........."; "#........#...#.#..........##..#"; "................#...#.#.....#.."; ".........#..#..#.#..#.#...#...."; "##....#...##.........#.#...#.##"; "....#..#.....##.....#.....##..."; "................#............#."; "..#..#...#.....#......#.....##."; "....#.......#...#...#...#..#..."; "....#..##....#.###.#...#..#...."; "#..##.....#.....#.##..##...##.#"; ".............###..........#...."; "..................#.....###...."; "..........#....#...#......#...."; "...#..##.......#......#.#...#.."; "..#.......................##.#."; "..#..#..#....#......#...#...##."; "#.............#................"; "..........#.#.#.........#.#...."; ".....##..#......##.#..........."; ".#.#.#.#....#.#...#.....#.#...#"; "......#.....##..............##."; "#..#.......##..##.............."; "#..#..#................###....."; ".....#......#.........#........"; "#...........#........#.#......."; "#........#.#...#....#....###..#"; "###..#.#...........#.##.....#.#"; "..#..........#..#............#."; "...#....#.......#..#.....###..."; ".#....#.##.#..###..............";
    ".....#.##.##.......###.##...#.#"; "..#..##.......###.............."; ".#.........###..#.............."; "..................###.....#..#."; "#....#....#.........#.....#...."; ".........#.#..#....#.....#....."; "....##.......##.......#.#......"; ".....#...#.##.....#............"; "....#.#.#.......#.............."; ".##..#.#..#.......##..........."; "....#....##..#.....##.......#.#"; ".....##....#..#.#........#....."; "........#.#.#....#....##...#..#"; "..#......#.#.#..#.##....#.#.#.."; "..#...#........#..#..........#."; ".........#...................#."; "........#.....##..#....#....#.."; "#..............#..........#...."; "#........#.#...........#.#....."; "..#......................#.#..#"; ".........#.#.....#.#..........#"; "......#....#.#.##........#....."; ".#....##......##..#...#.......#"; "..#........#...#.##....#..#.#.."; ".......#.....#..........#.....#"; ".........#.#..#.........#....#."; "..........#.##.........##..#..."; "......#.#..#.....#.#..........#"; "......#.#.#..#..#.#............"; "...##.#..#..............#....#."; "#..........#..................."; ".#....#..#.#.......#........#.."; "...#...#......#....#......#...."; "..#.#.......#.......#.......#.#"; "...#.#...#........#.....#......"; "#.......#..#..................."; "#..#..#.............#..#..#..#."; "#.......................#....##"; ".#.........#....#....#........."; "...............#...#..#....#..#"; "#.....#.#...#.#.....#.........."; "....##.#..#...#.#....###...#.#."; ".................#....#........"; "####.......##...##.......#.##.."; "#..#....#....##............#..."; "..##......#..#........#........"; "....#..#..........#......#...##"; "..#.#.............#...........#"; "#...............#...#.......#.#"; "#..#.........#.##.#.......#...#";
    "......#.....#.............#...#"; "......#.##.........##...#......"; "..#......##.#........#.......#."; "#..#.........#.##.............."; "..#....#...#...#..#.....#.#...."; "................#.......#......"; "#.....#..............##....#.##"; "##.....#...#.#.....#..##...#..."; "#.#............##..........#..#"; "..#.##......#..#....#.........."; "....##.#....#.......##.....#..."; "......#.#....###...#..........."; "..................#......#....#"; "..............##..............."; "......#..#....#.....#.........."; ".......#........#...#.........."; "..#......#......##..#.##..#...."; "..#.#...#...............#......"; "....#.#.............#.#......#."; "....#.#.....#......#..#.......#"; "........................#..#..."; ".................#...........#."; "#......#......#.#.#.....##....."; "..#....##...#.....##.#.....#..#"; "....#.........#....#.##.#.#...."; "..#....###....................."; ".....#.#....#......#....##....#"; "#.......#...#......##.......#.."; "#....#.........##.....#........"; "#.....#...........#..#.....#..."; ".................#.....#..##..#"; "..#...#......####...##........."; "..............................."; "#........#.....#..............."; ".#.........#....#.#......##...."; "...#..........#.........#.#.#.#"; "......##......#....###........#"; ".....................#.#.#....."; "......#..#..#.......#...#......"; "...##.#.............#.#.......#"; "..#.#...#..#....#.....#.....#.."; "..#..#.....................#..#"; "........#....#..........#..#..."; "#.##....#..#.#..#............#."; "..............###.............#"; ".#.#..........#.#....#...#....#"; "....#..........#.#..#......#..."; ".........##.#...#.............."; "..................#.....#.#...."; ".#....#.......#.##.#.........#.";
    ".##..#...#......#..#..........."; ".#.........#..........#.#......"; "#.#......#.#.#.#.......#...#.#."; ".......#....#.#......#......#.."; "...#..#....#.#..#..##...##....."; "#.#.#.......#....#.........##.."; "#..#....#........###....#.#...."; "....#..#.........#....#...#...."; "...#.#.#.#..#..##.....#.##....."; ".......#.......#..............."; "#.#.#......##....#............."; "...#.##........#.....#...##.#.."; "...#.#.###..........#.......#.."; ".....#...#.......#.........#..."; "............#..#...#..##......."; "...#....#..##.##..........#.##."; "..................#........#..."; "....#.##.#.##........#.#......."; ".#...........##.....##.......#."; "#...#.........#.....##........."; "#..#....#.#.........#.........."; "..#......#.#.#......#.....#..#."; "..##......#..............#.....";
 |]

type Point =
    Point of int * int

type Move =
    Move of int * int

let slide (Point(x,_)) (Move(dx,_)) (slope: string list) =
    (* Assuming that dy is 1 *)
    let width = slope.[0].Length
    slope |>
    List.fold 
        (fun (trees,x) s -> 
            match s.[x] with
            | '#' -> (trees+1, (x+dx) % width)
            | _ -> (trees, (x+dx) % width)
        )
        (0, 0)
    |> fst

let result1 =
    data
    |> List.ofArray
    |> slide (Point(0,0)) (Move(3,1))

// let rec eachOther = function 
//     | [] -> []
//     | [e] -> [e]
//     | e::_::xs -> e::(eachOther xs)

let eachOther nth (a: 'a array) = 
    [0..nth..a.Length-1]
    |> List.map (fun i -> a.[i])
    
let result2 =
    [Move(1,1);Move(3,1);Move(7,1);Move(5,1);Move(1,2)]
    |> List.map (
        (fun (Move(_,dy) as m) -> (m, data |> eachOther dy)) 
        >> (fun (m, slope) -> slide (Point(0,0)) m slope))
    |> List.reduce (*)