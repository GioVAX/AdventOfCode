module Day03

let data = 
 [|
    "............#....#............."; "...........##....#......#..#..#"; "......#.......#......#........."; "..#.#....#....#.............##."; "..#........####....#...#......."; "..##.....#.#.#..#.........#...."; "...#.#..#..#....#..#..#........"; "#.......#.........#....##.###.."; "......##..#.#...#.......#.#...."; "................##.........#.##"; "..##..........#...#.........#.#"; "..........#...##..............."; "#...#......#..#.#..#...##..#..."; "..##....#.......#......#..#...."; "....#......#......#....#......."; ".........#.....#..#............"; ".#...#.#.........#........#...."; "#..........####.....#.........."; "......##.....#....#..#........#"; "#......#......#...........#...."; "....#.........#....#...#..#..#."; ".#........#......#.#.....#....."; "..#.#.#..........#....#.......#"; "......#.#........##....##....##"; ".....#.#..#...#................"; "......#......##...............#"; "..#..##.............#...##....."; "......##......##..#......#....."; "....#.............#..##.....##."; "........#...............##....."; "..#......#.##..#...#....#...#.."; "#......#.......#.............#."; ".....#....##..............#...."; "#.#.........#....#..##....#...."; ".#...#...#....#.#............#."; "...#...#.#..##.##.......##....."; "......#..#....##..#.#..#..#...."; ".......##..#..#......#..#.....#"; ".##..#......#..........#....#.."; ".....#................#..#....#"; "........#..#....#.......#....#."; "..#......#.......#......#....#."; "....#...#.##........##....#...."; ".....#........#...........#...."; "...#....##..........#..#...#.#."; "...#.......#......#...##...#..."; ".#.....#........#........#.#..#"; ".#.........#..##.....#.......#."; "....#..#....#.......#......#..."; ".#.#...##..##................##";
    "......#.#...#.......#....#....#"; "........#....#..#.....#......#."; ".......#..........#......#....."; "..............................."; "..#..#####..#..#..........#.#.."; ".....#....##................#.#"; ".................##............"; ".#...#...#..#...........#...##."; "..#..#.#...........#.....##...."; ".#.......#.....#..##..#.#....#."; "..........#.#......##...##....."; "........##..#......##...#......"; "#......................#......."; "............#.....#....#.#...#."; "#......#..........##..#........"; ".........#.......#...#.#......."; "...........##....#........#...."; "#........#.....#...#........##."; ".#......##......#.##.......#..#"; ".....#......#.#......#.......#."; ".....#.#.........#............."; "...........#..#....#.....#.#..."; "...#............#...#.........."; "..#..#...#....................."; "......#..#...#....#............"; ".#.#.#........#..#...#........."; "..........#........#..#........"; "..............#...#....#......."; "..#....#....##.......#...#.##.."; ".#.........#...#......#........"; "..#......#...#.........##.#...#"; "...#.....#...#..#.............#"; ".##........#.#.#.............#."; "..#.............#..#.#...#....#"; "#...#.........#......#......#.."; ".......##..#.#..........#...#.."; ".......#.............#..#.#...."; ".#..#....#.#..................."; "....##...#..#....#..#.........."; "....#.#............#..........."; "###........##..#.#..#.........."; ".#.#.#.......#...........#..#.#"; "..........##..#.............#.."; ".#...........#......#.#..#..##."; "...###......#.##........#.....#"; "....#..#..#...#................"; "...#.....#........#............"; "....#...#...#..#..##.##.......#"; "#.......#......#....#.......#.."; "#.............#...#............";
    "##......#..#...#....##.#...#..."; ".##....................#....#.."; "..#.....#....#.#....#......#..."; ".......#..#..#............#...#"; ".#.....#.......#..#..#..#......"; "......##......................."; "#..#...#.#.#....#.....#..#....."; "...................#...#...#..."; "........#....##..#....#........"; "##......#.#......##.###........"; ".........#...##................"; ".......#...#...#.......##......"; "....#.......#......#.........##"; "....#....#.#..#.....#.........."; "...........#.......#........#.."; "..#.........###.#........#....."; ".......#...........#.#.....##.."; "..#...#..#..........#.........."; "..........#.#....#............."; ".##....#........##............."; ".............#.#####........#.#"; ".................##...#........"; "##...#.#.......##........#....."; ".#...#...#..#..#....#....#....."; "..#...#........#..#............"; "##...#.#........#......##.#..##"; ".##......#..............##.#..#"; ".........#...#............#...#"; "....#..#....#...........#......"; "........#..#....#...##...#....."; "..#..............#...#.#.....#."; ".#.......#.#.....#..###.......#"; "...................#.......#..."; "........##.....#..#.......##..."; ".....#....................#...#"; "...#.#....#............#.#....."; "#.......#.......#....#........."; "..#...............#............"; "##...#...#...#..............#.."; "...#..........#..#....##......."; "#............##.##......#.#.#.."; ".#...........#.........#....##."; "..##....##.#....#.#.#.##...##.#"; "........#.#.#.............#...."; ".#...........#....##...#...#.#."; ".##...#.................#......"; "....#.#..#....................#"; ".##......#........#..#........."; "...#...............#..........."; ".#.#..##..##.#........#........";
    "...........#....#.#.#......#..."; "...................#........#.#"; "..#............#...#.#........#"; "....#....#.#.##......#...#....."; "..................#............"; "..........................#...."; "........#......................"; "......#.#...#.#..##......#.#.#."; ".........#...#..#.............."; "..#.......#..........##..#....."; ".........#............#........"; "......#..#..#...###....#....#.."; "#..#..............##.###..##..#"; ".#..................#.....#...#"; "........#........#........#...."; ".........#........#.##......#.."; "..#.....#.#..###...#....#......"; "..#................##....#....."; "..#.#....##.....#......##...#.."; "...#.......#........##........."; "#........#...#.#..........##..#"; "................#...#.#.....#.."; ".........#..#..#.#..#.#...#...."; "##....#...##.........#.#...#.##"; "....#..#.....##.....#.....##..."; "................#............#."; "..#..#...#.....#......#.....##."; "....#.......#...#...#...#..#..."; "....#..##....#.###.#...#..#...."; "#..##.....#.....#.##..##...##.#"; ".............###..........#...."; "..................#.....###...."; "..........#....#...#......#...."; "...#..##.......#......#.#...#.."; "..#.......................##.#."; "..#..#..#....#......#...#...##."; "#.............#................"; "..........#.#.#.........#.#...."; ".....##..#......##.#..........."; ".#.#.#.#....#.#...#.....#.#...#"; "......#.....##..............##."; "#..#.......##..##.............."; "#..#..#................###....."; ".....#......#.........#........"; "#...........#........#.#......."; "#........#.#...#....#....###..#"; "###..#.#...........#.##.....#.#"; "..#..........#..#............#."; "...#....#.......#..#.....###..."; ".#....#.##.#..###..............";
    ".....#.##.##.......###.##...#.#"; "..#..##.......###.............."; ".#.........###..#.............."; "..................###.....#..#."; "#....#....#.........#.....#...."; ".........#.#..#....#.....#....."; "....##.......##.......#.#......"; ".....#...#.##.....#............"; "....#.#.#.......#.............."; ".##..#.#..#.......##..........."; "....#....##..#.....##.......#.#"; ".....##....#..#.#........#....."; "........#.#.#....#....##...#..#"; "..#......#.#.#..#.##....#.#.#.."; "..#...#........#..#..........#."; ".........#...................#."; "........#.....##..#....#....#.."; "#..............#..........#...."; "#........#.#...........#.#....."; "..#......................#.#..#"; ".........#.#.....#.#..........#"; "......#....#.#.##........#....."; ".#....##......##..#...#.......#"; "..#........#...#.##....#..#.#.."; ".......#.....#..........#.....#"; ".........#.#..#.........#....#."; "..........#.##.........##..#..."; "......#.#..#.....#.#..........#"; "......#.#.#..#..#.#............"; "...##.#..#..............#....#."; "#..........#..................."; ".#....#..#.#.......#........#.."; "...#...#......#....#......#...."; "..#.#.......#.......#.......#.#"; "...#.#...#........#.....#......"; "#.......#..#..................."; "#..#..#.............#..#..#..#."; "#.......................#....##"; ".#.........#....#....#........."; "...............#...#..#....#..#"; "#.....#.#...#.#.....#.........."; "....##.#..#...#.#....###...#.#."; ".................#....#........"; "####.......##...##.......#.##.."; "#..#....#....##............#..."; "..##......#..#........#........"; "....#..#..........#......#...##"; "..#.#.............#...........#"; "#...............#...#.......#.#"; "#..#.........#.##.#.......#...#";
    "......#.....#.............#...#"; "......#.##.........##...#......"; "..#......##.#........#.......#."; "#..#.........#.##.............."; "..#....#...#...#..#.....#.#...."; "................#.......#......"; "#.....#..............##....#.##"; "##.....#...#.#.....#..##...#..."; "#.#............##..........#..#"; "..#.##......#..#....#.........."; "....##.#....#.......##.....#..."; "......#.#....###...#..........."; "..................#......#....#"; "..............##..............."; "......#..#....#.....#.........."; ".......#........#...#.........."; "..#......#......##..#.##..#...."; "..#.#...#...............#......"; "....#.#.............#.#......#."; "....#.#.....#......#..#.......#"; "........................#..#..."; ".................#...........#."; "#......#......#.#.#.....##....."; "..#....##...#.....##.#.....#..#"; "....#.........#....#.##.#.#...."; "..#....###....................."; ".....#.#....#......#....##....#"; "#.......#...#......##.......#.."; "#....#.........##.....#........"; "#.....#...........#..#.....#..."; ".................#.....#..##..#"; "..#...#......####...##........."; "..............................."; "#........#.....#..............."; ".#.........#....#.#......##...."; "...#..........#.........#.#.#.#"; "......##......#....###........#"; ".....................#.#.#....."; "......#..#..#.......#...#......"; "...##.#.............#.#.......#"; "..#.#...#..#....#.....#.....#.."; "..#..#.....................#..#"; "........#....#..........#..#..."; "#.##....#..#.#..#............#."; "..............###.............#"; ".#.#..........#.#....#...#....#"; "....#..........#.#..#......#..."; ".........##.#...#.............."; "..................#.....#.#...."; ".#....#.......#.##.#.........#.";
    ".##..#...#......#..#..........."; ".#.........#..........#.#......"; "#.#......#.#.#.#.......#...#.#."; ".......#....#.#......#......#.."; "...#..#....#.#..#..##...##....."; "#.#.#.......#....#.........##.."; "#..#....#........###....#.#...."; "....#..#.........#....#...#...."; "...#.#.#.#..#..##.....#.##....."; ".......#.......#..............."; "#.#.#......##....#............."; "...#.##........#.....#...##.#.."; "...#.#.###..........#.......#.."; ".....#...#.......#.........#..."; "............#..#...#..##......."; "...#....#..##.##..........#.##."; "..................#........#..."; "....#.##.#.##........#.#......."; ".#...........##.....##.......#."; "#...#.........#.....##........."; "#..#....#.#.........#.........."; "..#......#.#.#......#.....#..#."; "..##......#..............#.....";
 |]

type Point =
    Point of int * int

type Move =
    Move of int * int

let slide (Point(x,_)) (Move(dx,_)) (slope: string list) =
    (* Assuming that dy is 1 *)
    let width = slope.[0].Length
    slope |>
    List.fold 
        (fun (trees,x) s -> 
            match s.[x] with
            | '#' -> (trees+1, (x+dx) % width)
            | _ -> (trees, (x+dx) % width)
        )
        (0, 0)
    |> fst

let result1 =
    data
    |> List.ofArray
    |> slide (Point(0,0)) (Move(3,1))

let rec eachOther = function 
    | [] -> []
    | [e] -> [e]
    | e::_::xs -> e::(eachOther xs)

let result2 =
    let data' = data |> List.ofArray
    let origin = Point(0,0)

    let f1 = data' |> slide origin (Move(1,1))
    let f2 = data' |> slide origin (Move(3,1))
    let f3 = data' |> slide origin (Move(7,1))
    let f4 = data' |> slide origin (Move(5,1))
    let f5 = data' |> eachOther |> slide origin (Move(1,2))

    f1 * f2 * f3 * f4 * f5
